(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
class TestCounter {
    constructor() {
        this.n = 0;
    }
    getNumber() {
        return this.n;
    }
    setNumber(n) {
        this.n = n;
    }
}
exports.default = TestCounter;
},{}],2:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
class Input {
    constructor() {
        this.initializeInputs();
        this.upKeyDown = false;
        this.leftKeyDown = false;
        this.rightKeyDown = false;
    }
    initializeInputs() {
        document.addEventListener('keydown', (ev) => {
            if (ev.keyCode === 37) {
                this.leftKeyDown = true;
            }
            else if (ev.keyCode === 39) {
                this.rightKeyDown = true;
            }
            else if (ev.keyCode === 38) {
                this.upKeyDown = true;
            }
        });
        document.addEventListener('keyup', (ev) => {
            if (ev.keyCode === 37) {
                this.leftKeyDown = false;
            }
            else if (ev.keyCode === 38) {
                this.upKeyDown = false;
            }
            else if (ev.keyCode === 39) {
                this.rightKeyDown = false;
            }
        });
    }
}
exports.default = Input;
},{}],3:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
class Level {
    constructor(imgdir, message, location, canvas) {
        this.background = new Image(canvas.width, canvas.height);
        this.background.src = imgdir;
        this.message = message;
        this.location = location;
    }
}
exports.default = Level;
},{}],4:[function(require,module,exports){
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const TestCounter_1 = __importDefault(require("./app/TestCounter"));
const Input_1 = __importDefault(require("./input/Input"));
const Entity_1 = __importDefault(require("./obj/Entity"));
const Level_1 = __importDefault(require("./level/Level"));
const RENDER_CANVAS_ID = 'renderCanvas';
const MESSAGE_PARAGRAPH_ID = 'flavourText';
const LOCATION_ID = 'location';
let x = new TestCounter_1.default();
let canvas = document.getElementById(RENDER_CANVAS_ID);
let gameText = document.getElementById(MESSAGE_PARAGRAPH_ID);
let locationHeader = document.getElementById(LOCATION_ID);
let r = canvas.getContext('2d');
let counter = 0;
let keyboard;
let character;
let background;
let message;
function init() {
    canvas.width = 800;
    canvas.height = 400;
    keyboard = new Input_1.default();
    character = new Entity_1.default('res/sprite/person.png', 100, 150);
    r.font = '12px Arial black';
    loadLevel('res/blockbuster-interior.jpg', 'You are in blockbuster');
}
function loadLevel(dir, message) {
    character.setX(canvas.width / 2 - character.getWidth() / 2);
    let level = new Level_1.default(dir, message, 'Blockbuster', canvas);
    background = level.background;
    message = level.message;
    gameText.textContent = message;
    locationHeader.textContent = level.location;
}
function loop() {
    ++counter;
    r.clearRect(0, 0, 800, 400);
    r.fillText(counter.toString(), 10, 10);
    character.tick(canvas.width, canvas.height);
    if (keyboard.leftKeyDown) {
        character.accelerateLeft(3);
    }
    else if (keyboard.rightKeyDown) {
        character.accelerateRight(3);
    }
    if (keyboard.upKeyDown) {
        character.accelerateUp(40);
    }
    r.drawImage(background, 0, -250);
    r.drawImage(character.getImageSource(), character.getX(), character.getY(), character.getWidth(), character.getHeight());
    requestAnimationFrame(loop);
}
init();
loop();
},{"./app/TestCounter":1,"./input/Input":2,"./level/Level":3,"./obj/Entity":5}],5:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
class Entity {
    constructor(imgsrc, x_size, y_size) {
        this.GRAVITY = 9.81;
        this.MAX_VELOCITY = 7;
        this.x = 0;
        this.y = 0;
        this.dx = 0;
        this.dy = 0;
        this.image = new Image(x_size, y_size);
        this.image.src = imgsrc;
        this.x_size = x_size;
        this.y_size = y_size;
        this.hasJumped = true;
    }
    tick(x_max, y_max) {
        this.x += this.dx;
        this.dy += this.GRAVITY;
        if (this.x + this.image.width > x_max) {
            this.x = x_max - this.image.width;
        }
        else if (this.x < 0) {
            this.x = 0;
        }
        this.y += this.dy;
        // Hit the ground
        if (this.y + this.y_size >= y_max) {
            this.y = y_max - this.y_size;
            this.dy = 0;
            this.hasJumped = false;
        }
        // Friction
        if (this.dx > 0) {
            --this.dx;
        }
        if (this.dx < 0) {
            ++this.dx;
        }
    }
    getWidth() {
        return this.x_size;
    }
    getHeight() {
        return this.y_size;
    }
    getImageSource() {
        return this.image;
    }
    accelerateLeft(speed) {
        this.dx -= speed;
        if (this.dx < -this.MAX_VELOCITY) {
            this.dx = -this.MAX_VELOCITY;
        }
    }
    accelerateRight(speed) {
        this.dx += speed;
        if (this.dx > this.MAX_VELOCITY) {
            this.dx = this.MAX_VELOCITY;
        }
    }
    accelerateUp(speed) {
        if (!this.hasJumped) {
            this.hasJumped = true;
            this.dy -= speed;
        }
    }
    setX(x) {
        this.x = x;
    }
    setY(y) {
        this.y = y;
    }
    getX() {
        return this.x;
    }
    getY() {
        return this.y;
    }
    getYLower() {
        return this.image.height + this.y;
    }
}
exports.default = Entity;
},{}]},{},[4])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvYXBwL1Rlc3RDb3VudGVyLnRzIiwic3JjL2lucHV0L0lucHV0LnRzIiwic3JjL2xldmVsL0xldmVsLnRzIiwic3JjL21haW4udHMiLCJzcmMvb2JqL0VudGl0eS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7O0FDQUEsTUFBcUIsV0FBVztJQUU1QjtRQUNJLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ2YsQ0FBQztJQUVNLFNBQVM7UUFDWixPQUFPLElBQUksQ0FBQyxDQUFDLENBQUM7SUFDbEIsQ0FBQztJQUVNLFNBQVMsQ0FBQyxDQUFTO1FBQ3RCLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ2YsQ0FBQztDQUNKO0FBYkQsOEJBYUM7Ozs7QUNiRCxNQUFxQixLQUFLO0lBTXRCO1FBQ0ksSUFBSSxDQUFDLGdCQUFnQixFQUFFLENBQUM7UUFDeEIsSUFBSSxDQUFDLFNBQVMsR0FBRyxLQUFLLENBQUM7UUFDdkIsSUFBSSxDQUFDLFdBQVcsR0FBRyxLQUFLLENBQUM7UUFDekIsSUFBSSxDQUFDLFlBQVksR0FBRyxLQUFLLENBQUM7SUFDOUIsQ0FBQztJQUVPLGdCQUFnQjtRQUNwQixRQUFRLENBQUMsZ0JBQWdCLENBQUMsU0FBUyxFQUFFLENBQUMsRUFBRSxFQUFFLEVBQUU7WUFDeEMsSUFBSSxFQUFFLENBQUMsT0FBTyxLQUFLLEVBQUUsRUFBRTtnQkFDbkIsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUM7YUFDM0I7aUJBQU0sSUFBSSxFQUFFLENBQUMsT0FBTyxLQUFLLEVBQUUsRUFBRTtnQkFDMUIsSUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUM7YUFDNUI7aUJBQU0sSUFBSSxFQUFFLENBQUMsT0FBTyxLQUFLLEVBQUUsRUFBRTtnQkFDMUIsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUM7YUFDekI7UUFDTCxD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R0FBRyxJQUFJLENBQUM7WUFDdEIsSUFBSSxDQUFDLEVBQUUsSUFBSSxLQUFLLENBQUM7U0FDcEI7SUFDTCxDQUFDO0lBRU0sSUFBSSxDQUFDLENBQVM7UUFDakIsSUFBSSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDZixDQUFDO0lBRU0sSUFBSSxDQUFDLENBQVM7UUFDakIsSUFBSSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDZixDQUFDO0lBRU0sSUFBSTtRQUNQLE9BQU8sSUFBSSxDQUFDLENBQUMsQ0FBQztJQUNsQixDQUFDO0lBRU0sSUFBSTtRQUNQLE9BQU8sSUFBSSxDQUFDLENBQUMsQ0FBQztJQUNsQixDQUFDO0lBRU0sU0FBUztRQUNaLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQztJQUN0QyxDQUFDO0NBRUo7QUFuSEQseUJBbUhDIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oKXtmdW5jdGlvbiByKGUsbix0KXtmdW5jdGlvbiBvKGksZil7aWYoIW5baV0pe2lmKCFlW2ldKXt2YXIgYz1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlO2lmKCFmJiZjKXJldHVybiBjKGksITApO2lmKHUpcmV0dXJuIHUoaSwhMCk7dmFyIGE9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitpK1wiJ1wiKTt0aHJvdyBhLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsYX12YXIgcD1uW2ldPXtleHBvcnRzOnt9fTtlW2ldWzBdLmNhbGwocC5leHBvcnRzLGZ1bmN0aW9uKHIpe3ZhciBuPWVbaV1bMV1bcl07cmV0dXJuIG8obnx8cil9LHAscC5leHBvcnRzLHIsZSxuLHQpfXJldHVybiBuW2ldLmV4cG9ydHN9Zm9yKHZhciB1PVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmUsaT0wO2k8dC5sZW5ndGg7aSsrKW8odFtpXSk7cmV0dXJuIG99cmV0dXJuIHJ9KSgpIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgVGVzdENvdW50ZXIge1xyXG4gICAgcHJpdmF0ZSBuOiBudW1iZXI7XHJcbiAgICBwdWJsaWMgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgdGhpcy5uID0gMDtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZ2V0TnVtYmVyKCk6IG51bWJlciB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMubjtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgc2V0TnVtYmVyKG46IG51bWJlcik6IHZvaWQge1xyXG4gICAgICAgIHRoaXMubiA9IG47XHJcbiAgICB9XHJcbn0iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBJbnB1dCB7XHJcblxyXG4gICAgcHVibGljIHVwS2V5RG93bjogYm9vbGVhbjtcclxuICAgIHB1YmxpYyBsZWZ0S2V5RG93bjogYm9vbGVhbjtcclxuICAgIHB1YmxpYyByaWdodEtleURvd246IGJvb2xlYW47XHJcblxyXG4gICAgcHVibGljIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgICAgIHRoaXMuaW5pdGlhbGl6ZUlucHV0cygpO1xyXG4gICAgICAgIHRoaXMudXBLZXlEb3duID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5sZWZ0S2V5RG93biA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMucmlnaHRLZXlEb3duID0gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBpbml0aWFsaXplSW5wdXRzKCk6IHZvaWQge1xyXG4gICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCAoZXYpID0+IHtcclxuICAgICAgICAgICAgaWYgKGV2LmtleUNvZGUgPT09IDM3KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmxlZnRLZXlEb3duID0gdHJ1ZTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChldi5rZXlDb2RlID09PSAzOSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yaWdodEtleURvd24gPSB0cnVlO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGV2LmtleUNvZGUgPT09IDM4KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnVwS2V5RG93biA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXl1cCcsIChldikgPT4ge1xyXG4gICAgICAgICAgICBpZiAoZXYua2V5Q29kZSA9PT0gMzcpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMubGVmdEtleURvd24gPSBmYWxzZTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChldi5rZXlDb2RlID09PSAzOCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy51cEtleURvd24gPSBmYWxzZTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChldi5rZXlDb2RlID09PSAzOSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yaWdodEtleURvd24gPSBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59IiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgTGV2ZWwge1xyXG5cclxuICAgIHB1YmxpYyBtZXNzYWdlOiBzdHJpbmc7XHJcbiAgICBwdWJsaWMgYmFja2dyb3VuZDogSFRNTEltYWdlRWxlbWVudDtcclxuICAgIHB1YmxpYyBsb2NhdGlvbjogc3RyaW5nO1xyXG5cclxuICAgIHB1YmxpYyBjb25zdHJ1Y3RvcihpbWdkaXI6IHN0cmluZywgbWVzc2FnZTogc3RyaW5nLCBsb2NhdGlvbjogc3RyaW5nLCBjYW52YXM6IEhUTUxDYW52YXNFbGVtZW50KSB7XHJcbiAgICAgICAgdGhpcy5iYWNrZ3JvdW5kID0gbmV3IEltYWdlKGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7XHJcbiAgICAgICAgdGhpcy5iYWNrZ3JvdW5kLnNyYyA9IGltZ2RpcjtcclxuICAgICAgICB0aGlzLm1lc3NhZ2UgPSBtZXNzYWdlO1xyXG4gICAgICAgIHRoaXMubG9jYXRpb24gPSBsb2NhdGlvbjtcclxuICAgIH1cclxufSIsImltcG9ydCBUZXN0Q291bnRlciBmcm9tICcuL2FwcC9UZXN0Q291bnRlcic7XHJcbmltcG9ydCBJbnB1dCBmcm9tICcuL2lucHV0L0lucHV0JztcclxuaW1wb3J0IEVudGl0eSBmcm9tICcuL29iai9FbnRpdHknO1xyXG5pbXBvcnQgeyBjb2xsYXBzZVRleHRDaGFuZ2VSYW5nZXNBY3Jvc3NNdWx0aXBsZVZlcnNpb25zIH0gZnJvbSAndHlwZXNjcmlwdCc7XHJcbmltcG9ydCBMZXZlbCBmcm9tICcuL2xldmVsL0xldmVsJztcclxuXHJcbmNvbnN0IFJFTkRFUl9DQU5WQVNfSUQ6IHN0cmluZyA9ICdyZW5kZXJDYW52YXMnO1xyXG5jb25zdCBNRVNTQUdFX1BBUkFHUkFQSF9JRDogc3RyaW5nID0gJ2ZsYXZvdXJUZXh0JztcclxuY29uc3QgTE9DQVRJT05fSUQ6IHN0cmluZyA9ICdsb2NhdGlvbic7XHJcblxyXG5sZXQgeDogVGVzdENvdW50ZXIgPSBuZXcgVGVzdENvdW50ZXIoKTtcclxuXHJcbmxldCBjYW52YXM6IEhUTUxDYW52YXNFbGVtZW50ID0gPEhUTUxDYW52YXNFbGVtZW50PmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFJFTkRFUl9DQU5WQVNfSUQpO1xyXG5sZXQgZ2FtZVRleHQ6IEhUTUxQYXJhZ3JhcGhFbGVtZW50ID0gPEhUTUxQYXJhZ3JhcGhFbGVtZW50PmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKE1FU1NBR0VfUEFSQUdSQVBIX0lEKTtcclxubGV0IGxvY2F0aW9uSGVhZGVyOiBIVE1MSGVhZGluZ0VsZW1lbnQgPSA8SFRNTEhlYWRpbmdFbGVtZW50PmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKExPQ0FUSU9OX0lEKTtcclxubGV0IHI6IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCA9IDxDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQ+Y2FudmFzLmdldENvbnRleHQoJzJkJyk7XHJcbmxldCBjb3VudGVyOiBudW1iZXIgPSAwO1xyXG5cclxubGV0IGtleWJvYXJkOiBJbnB1dDtcclxubGV0IGNoYXJhY3RlcjogRW50aXR5O1xyXG5sZXQgYmFja2dyb3VuZDogSFRNTEltYWdlRWxlbWVudDtcclxubGV0IG1lc3NhZ2U6IHN0cmluZztcclxuXHJcbmZ1bmN0aW9uIGluaXQoKTogdm9pZCB7XHJcbiAgICBjYW52YXMud2lkdGggPSA4MDA7XHJcbiAgICBjYW52YXMuaGVpZ2h0ID0gNDAwO1xyXG4gICAga2V5Ym9hcmQgPSBuZXcgSW5wdXQoKTtcclxuICAgIGNoYXJhY3RlciA9IG5ldyBFbnRpdHkoJ3Jlcy9zcHJpdGUvcGVyc29uLnBuZycsIDEwMCwgMTUwKTtcclxuICAgIHIuZm9udCA9ICcxMnB4IEFyaWFsIGJsYWNrJztcclxuICAgIGxvYWRMZXZlbCgncmVzL2Jsb2NrYnVzdGVyLWludGVyaW9yLmpwZycsICdZb3UgYXJlIGluIGJsb2NrYnVzdGVyJyk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGxvYWRMZXZlbChkaXI6IHN0cmluZywgbWVzc2FnZTogc3RyaW5nKTogdm9pZCB7XHJcbiAgICBjaGFyYWN0ZXIuc2V0WChjYW52YXMud2lkdGggLyAyIC0gY2hhcmFjdGVyLmdldFdpZHRoKCkgLyAyKTtcclxuICAgIGxldCBsZXZlbCA9IG5ldyBMZXZlbChkaXIsIG1lc3NhZ2UsICdCbG9ja2J1c3RlcicsIGNhbnZhcyk7XHJcbiAgICBiYWNrZ3JvdW5kID0gbGV2ZWwuYmFja2dyb3VuZDtcclxuICAgIG1lc3NhZ2UgPSBsZXZlbC5tZXNzYWdlO1xyXG4gICAgZ2FtZVRleHQudGV4dENvbnRlbnQgPSBtZXNzYWdlO1xyXG4gICAgbG9jYXRpb25IZWFkZXIudGV4dENvbnRlbnQgPSBsZXZlbC5sb2NhdGlvbjtcclxufVxyXG5cclxuZnVuY3Rpb24gbG9vcCgpOiB2b2lkIHtcclxuICAgICsrY291bnRlcjtcclxuICAgIHIuY2xlYXJSZWN0KDAsIDAsIDgwMCwgNDAwKTtcclxuICAgIHIuZmlsbFRleHQoY291bnRlci50b1N0cmluZygpLCAxMCwgMTApO1xyXG4gICAgY2hhcmFjdGVyLnRpY2soY2FudmFzLndpZHRoLCBjYW52YXMuaGVpZ2h0KTtcclxuICAgIGlmIChrZXlib2FyZC5sZWZ0S2V5RG93bikge1xyXG4gICAgICAgIGNoYXJhY3Rlci5hY2NlbGVyYXRlTGVmdCgzKTtcclxuICAgIH0gZWxzZSBpZiAoa2V5Ym9hcmQucmlnaHRLZXlEb3duKSB7XHJcbiAgICAgICAgY2hhcmFjdGVyLmFjY2VsZXJhdGVSaWdodCgzKTtcclxuICAgIH1cclxuICAgIGlmIChrZXlib2FyZC51cEtleURvd24pIHtcclxuICAgICAgICBjaGFyYWN0ZXIuYWNjZWxlcmF0ZVVwKDQwKTtcclxuICAgIH1cclxuICAgIHIuZHJhd0ltYWdlKGJhY2tncm91bmQsIDAsIC0yNTApO1xyXG4gICAgci5kcmF3SW1hZ2UoY2hhcmFjdGVyLmdldEltYWdlU291cmNlKCksIGNoYXJhY3Rlci5nZXRYKCksIGNoYXJhY3Rlci5nZXRZKCksIGNoYXJhY3Rlci5nZXRXaWR0aCgpLCBjaGFyYWN0ZXIuZ2V0SGVpZ2h0KCkpO1xyXG4gICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGxvb3ApO1xyXG59XHJcblxyXG5pbml0KCk7XHJcbmxvb3AoKTsiLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBFbnRpdHkge1xyXG5cclxuICAgIHByaXZhdGUgcmVhZG9ubHkgR1JBVklUWTogbnVtYmVyID0gOS44MTtcclxuICAgIHByaXZhdGUgcmVhZG9ubHkgTUFYX1ZFTE9DSVRZOiBudW1iZXIgPSA3O1xyXG5cclxuICAgIHByaXZhdGUgeDogbnVtYmVyO1xyXG4gICAgcHJpdmF0ZSB5OiBudW1iZXI7XHJcblxyXG4gICAgcHJpdmF0ZSBkeDogbnVtYmVyO1xyXG4gICAgcHJpdmF0ZSBkeTogbnVtYmVyO1xyXG5cclxuICAgIHByaXZhdGUgeF9zaXplOiBudW1iZXI7XHJcbiAgICBwcml2YXRlIHlfc2l6ZTogbnVtYmVyO1xyXG5cclxuICAgIHByaXZhdGUgaGFzSnVtcGVkOiBib29sZWFuO1xyXG5cclxuICAgIHByaXZhdGUgaW1hZ2U6IEhUTUxJbWFnZUVsZW1lbnQ7XHJcblxyXG4gICAgcHVibGljIGNvbnN0cnVjdG9yKGltZ3NyYzogc3RyaW5nLCB4X3NpemU6IG51bWJlciwgeV9zaXplOiBudW1iZXIpIHtcclxuICAgICAgICB0aGlzLnggPSAwO1xyXG4gICAgICAgIHRoaXMueSA9IDA7XHJcbiAgICAgICAgdGhpcy5keCA9IDA7XHJcbiAgICAgICAgdGhpcy5keSA9IDA7XHJcblxyXG4gICAgICAgIHRoaXMuaW1hZ2UgPSBuZXcgSW1hZ2UoeF9zaXplLCB5X3NpemUpO1xyXG4gICAgICAgIHRoaXMuaW1hZ2Uuc3JjID0gaW1nc3JjO1xyXG4gICAgICAgIHRoaXMueF9zaXplID0geF9zaXplO1xyXG4gICAgICAgIHRoaXMueV9zaXplID0geV9zaXplO1xyXG4gICAgICAgIHRoaXMuaGFzSnVtcGVkID0gdHJ1ZTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgcHVibGljIHRpY2soeF9tYXg6IG51bWJlciwgeV9tYXg6IG51bWJlcik6IHZvaWQge1xyXG5cclxuICAgICAgICB0aGlzLnggKz0gdGhpcy5keDtcclxuICAgICAgICB0aGlzLmR5ICs9IHRoaXMuR1JBVklUWTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMueCArIHRoaXMuaW1hZ2Uud2lkdGggPiB4X21heCkge1xyXG4gICAgICAgICAgICB0aGlzLnggPSB4X21heCAtIHRoaXMuaW1hZ2Uud2lkdGg7XHJcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnggPCAwKSB7XHJcbiAgICAgICAgICAgIHRoaXMueCA9IDA7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLnkgKz0gdGhpcy5keTtcclxuXHJcbiAgICAgICAgLy8gSGl0IHRoZSBncm91bmRcclxuICAgICAgICBpZiAodGhpcy55ICsgdGhpcy55X3NpemUgPj0geV9tYXgpIHtcclxuICAgICAgICAgICAgdGhpcy55ID0geV9tYXggLSB0aGlzLnlfc2l6ZTtcclxuICAgICAgICAgICAgdGhpcy5keSA9IDA7XHJcbiAgICAgICAgICAgIHRoaXMuaGFzSnVtcGVkID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBGcmljdGlvblxyXG4gICAgICAgIGlmICh0aGlzLmR4ID4gMCkge1xyXG4gICAgICAgICAgICAtLXRoaXMuZHg7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLmR4IDwgMCkge1xyXG4gICAgICAgICAgICArK3RoaXMuZHg7XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZ2V0V2lkdGgoKTogbnVtYmVyIHtcclxuICAgICAgICByZXR1cm4gdGhpcy54X3NpemU7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGdldEhlaWdodCgpOiBudW1iZXIge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnlfc2l6ZTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZ2V0SW1hZ2VTb3VyY2UoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaW1hZ2U7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGFjY2VsZXJhdGVMZWZ0KHNwZWVkOiBudW1iZXIpIHtcclxuICAgICAgICB0aGlzLmR4IC09IHNwZWVkO1xyXG4gICAgICAgIGlmICh0aGlzLmR4IDwgLXRoaXMuTUFYX1ZFTE9DSVRZKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZHggPSAtdGhpcy5NQVhfVkVMT0NJVFk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBhY2NlbGVyYXRlUmlnaHQoc3BlZWQ6IG51bWJlcik6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuZHggKz0gc3BlZWQ7XHJcbiAgICAgICAgaWYgKHRoaXMuZHggPiB0aGlzLk1BWF9WRUxPQ0lUWSkge1xyXG4gICAgICAgICAgICB0aGlzLmR4ID0gdGhpcy5NQVhfVkVMT0NJVFk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBhY2NlbGVyYXRlVXAoc3BlZWQ6IG51bWJlcik6IHZvaWQge1xyXG4gICAgICAgIGlmICghdGhpcy5oYXNKdW1wZWQpIHtcclxuICAgICAgICAgICAgdGhpcy5oYXNKdW1wZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICB0aGlzLmR5IC09IHNwZWVkO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgc2V0WCh4OiBudW1iZXIpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLnggPSB4O1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzZXRZKHk6IG51bWJlcik6IHZvaWQge1xyXG4gICAgICAgIHRoaXMueSA9IHk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGdldFgoKTogbnVtYmVyIHtcclxuICAgICAgICByZXR1cm4gdGhpcy54O1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBnZXRZKCk6IG51bWJlciB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMueTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZ2V0WUxvd2VyKCk6IG51bWJlciB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaW1hZ2UuaGVpZ2h0ICsgdGhpcy55O1xyXG4gICAgfVxyXG5cclxufSJdfQ==
