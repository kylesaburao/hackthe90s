(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
class TestCounter {
    constructor() {
        this.n = 0;
    }
    getNumber() {
        return this.n;
    }
    setNumber(n) {
        this.n = n;
    }
}
exports.default = TestCounter;
},{}],2:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
class Input {
    constructor() {
        this.initializeInputs();
        this.upKeyDown = false;
        this.leftKeyDown = false;
        this.rightKeyDown = false;
    }
    initializeInputs() {
        document.addEventListener('keydown', (ev) => {
            if (ev.keyCode === 37) {
                this.leftKeyDown = true;
            }
            else if (ev.keyCode === 39) {
                this.rightKeyDown = true;
            }
            else if (ev.keyCode === 38) {
                this.upKeyDown = true;
                ev.preventDefault();
            }
        });
        document.addEventListener('keyup', (ev) => {
            if (ev.keyCode === 37) {
                this.leftKeyDown = false;
            }
            else if (ev.keyCode === 38) {
                this.upKeyDown = false;
            }
            else if (ev.keyCode === 39) {
                this.rightKeyDown = false;
            }
        });
    }
}
exports.default = Input;
},{}],3:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
class Level {
    constructor(level_number, imgdir, title, status, directions, left, right, canvas) {
        this.levelNumber = level_number;
        this.background = new Image(canvas.width, canvas.height);
        this.background.src = imgdir;
        this.title = title;
        this.status = status;
        this.directions = directions;
        this.leftLevelNumber = left;
        this.rightLevelNumber = right;
    }
}
exports.default = Level;
},{}],4:[function(require,module,exports){
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const TestCounter_1 = __importDefault(require("./app/TestCounter"));
const Input_1 = __importDefault(require("./input/Input"));
const Entity_1 = __importDefault(require("./obj/Entity"));
const Level_1 = __importDefault(require("./level/Level"));
const RENDER_CANVAS_ID = 'renderCanvas';
const TITLE_ID = 'title';
const STATUS_ID = 'status';
const DIRECTIONS_ID = 'directions';
let x = new TestCounter_1.default();
let canvas = document.getElementById(RENDER_CANVAS_ID);
let titleElement = document.getElementById(TITLE_ID);
let statusElement = document.getElementById(STATUS_ID);
let directionsElement = document.getElementById(DIRECTIONS_ID);
let r = canvas.getContext('2d');
let counter = 0;
let keyboard;
let character;
let background;
let title;
let status;
let direction;
let currentLevel;
let levels = new Array();
levels.push(new Level_1.default(1, 'res/bg/1.png', 'You\'re at Blockbuster', 'Alive', 'Go left for x. Go right for y.', 0, 2, canvas));
levels.push(new Level_1.default(0, 'res/bg/0-test.png', 'You\'re outside Blockbuster', 'Alive', 'Go left for x. Go right for y.', 11, 2, canvas));
function findLevel(levelNumber) {
    for (let i = 0; i < levels.length; ++i) {
        if (levels[i].levelNumber === levelNumber) {
            return levels[i];
        }
    }
    return levels[0];
}
function loadLevel(level) {
    character.setX(canvas.width / 2 - character.getWidth() / 2);
    currentLevel = level;
    background = currentLevel.background;
    titleElement.textContent = currentLevel.title;
    statusElement.textContent = currentLevel.status;
    directionsElement.textContent = currentLevel.directions;
}
function init() {
    canvas.width = 800;
    canvas.height = 400;
    keyboard = new Input_1.default();
    character = new Entity_1.default('res/sprite/walk-left.png', 'res/sprite/walk-right.png', 200, 275);
    r.font = '12px Arial black';
    loadLevel(findLevel(1));
}
function loop() {
    ++counter;
    r.clearRect(0, 0, canvas.width, canvas.height);
    r.fillText(counter.toString(), 10, 10);
    character.tick(canvas.width, canvas.height);
    if (keyboard.leftKeyDown) {
        character.accelerateLeft(3);
    }
    else if (keyboard.rightKeyDown) {
        character.accelerateRight(3);
    }
    if (keyboard.upKeyDown) {
        character.accelerateUp(20);
    }
    r.drawImage(background, 0, 0);
    r.drawImage(character.getImageSource(), character.getX(), character.getY(), character.getWidth(), character.getHeight());
    // Detect to switch level
    if (character.leftWallTouched()) {
        loadLevel(findLevel(currentLevel.leftLevelNumber));
    }
    else if (character.rightWallTouched()) {
        loadLevel(findLevel(currentLevel.rightLevelNumber));
    }
    requestAnimationFrame(loop);
}
init();
loop();
},{"./app/TestCounter":1,"./input/Input":2,"./level/Level":3,"./obj/Entity":5}],5:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
class Entity {
    constructor(src_left, src_right, x_size, y_size) {
        this.GRAVITY = 9.81 / 4;
        this.MAX_VELOCITY = 7;
        this.x = 0;
        this.y = 0;
        this.dx = 0;
        this.dy = 0;
        this.image = new Image(x_size, y_size);
        this.image.src = src_left;
        this.x_size = x_size;
        this.y_size = y_size;
        this.hasJumped = true;
        this.isLeftWallTouched = false;
        this.isRightWallTouched = false;
        this.leftWalking_src = src_left;
        this.rightWalking_src = src_right;
    }
    leftWallTouched() {
        return this.isLeftWallTouched;
    }
    rightWallTouched() {
        return this.isRightWallTouched;
    }
    tick(x_max, y_max) {
        this.x += this.dx;
        this.dy += this.GRAVITY;
        if (this.x + this.image.width > x_max) {
            // Right wall
            this.isRightWallTouched = true;
            this.x = x_max - this.image.width;
        }
        else if (this.x < 0) {
            this.isLeftWallTouched = true;
            this.x = 0;
        }
        else {
            this.isRightWallTouched = false;
            this.isLeftWallTouched = false;
        }
        this.y += this.dy;
        // Hit the ground
        if (this.y + this.y_size >= y_max) {
            this.y = y_max - this.y_size;
            this.dy = 0;
            this.hasJumped = false;
        }
        // Friction
        if (this.dx > 0) {
            // Going right
            this.image.src = this.rightWalking_src;
            --this.dx;
        }
        if (this.dx < 0) {
            // Going left
            this.image.src = this.leftWalking_src;
            ++this.dx;
        }
        else {
        }
    }
    getWidth() {
        return this.x_size;
    }
    getHeight() {
        return this.y_size;
    }
    getImageSource() {
        return this.image;
    }
    accelerateLeft(speed) {
        this.dx -= speed;
        if (this.dx < -this.MAX_VELOCITY) {
            this.dx = -this.MAX_VELOCITY;
        }
    }
    accelerateRight(speed) {
        this.dx += speed;
        if (this.dx > this.MAX_VELOCITY) {
            this.dx = this.MAX_VELOCITY;
        }
    }
    accelerateUp(speed) {
        if (!this.hasJumped) {
            this.hasJumped = true;
            this.dy -= speed;
        }
    }
    setX(x) {
        this.x = x;
    }
    setY(y) {
        this.y = y;
    }
    getX() {
        return this.x;
    }
    getY() {
        return this.y;
    }
    getYLower() {
        return this.image.height + this.y;
    }
}
exports.default = Entity;
},{}]},{},[4])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvYXBwL1Rlc3RDb3VudGVyLnRzIiwic3JjL2lucHV0L0lucHV0LnRzIiwic3JjL2xldmVsL0xldmVsLnRzIiwic3JjL21haW4udHMiLCJzcmMvb2JqL0VudGl0eS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7O0FDQUEsTUFBcUIsV0FBVztJQUU1QjtRQUNJLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ2YsQ0FBQztJQUVNLFNBQVM7UUFDWixPQUFPLElBQUksQ0FBQyxDQUFDLENBQUM7SUFDbEIsQ0FBQztJQUVNLFNBQVMsQ0FBQyxDQUFTO1FBQ3RCLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ2YsQ0FBQztDQUNKO0FBYkQsOEJBYUM7Ozs7QUNiRCxNQUFxQixLQUFLO0lBTXRCO1FBQ0ksSUFBSSxDQUFDLGdCQUFnQixFQUFFLENBQUM7UUFDeEIsSUFBSSxDQUFDLFNBQVMsR0FBRyxLQUFLLENBQUM7UUFDdkIsSUFBSSxDQUFDLFdBQVcsR0FBRyxLQUFLLENBQUM7UUFDekIsSUFBSSxDQUFDLFlBQVksR0FBRyxLQUFLLENBQUM7SUFDOUIsQ0FBQztJQUVPLGdCQUFnQjtRQUNwQixRQUFRLENBQUMsZ0JBQWdCLENBQUMsU0FBUyxFQUFFLENBQUMsRUFBRSxFQUFFLEVBQUU7WUFDeEMsSUFBSSxFQUFFLENBQUMsT0FBTyxLQUFLLEVBQUUsRUFBRTtnQkFDbkIsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUM7YUFDM0I7aUJBQU0sSUFBSSxFQUFFLENBQUMsT0FBTyxLQUFLLEVBQUUsRUFBRTtnQkFDMUIsSUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUM7YUFDNUI7aUJBQU0sSUFBSSxFQUFFLENBQUMsT0FBTyxLQUFLLEVBQUUsRUFBRTtnQkFDMUIsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUM7Z0JBQ3RCLEVBQUUs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LENBQUM7SUFFTSxJQUFJLENBQUMsQ0FBUztRQUNqQixJQUFJLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUNmLENBQUM7SUFFTSxJQUFJLENBQUMsQ0FBUztRQUNqQixJQUFJLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUNmLENBQUM7SUFFTSxJQUFJO1FBQ1AsT0FBTyxJQUFJLENBQUMsQ0FBQyxDQUFDO0lBQ2xCLENBQUM7SUFFTSxJQUFJO1FBQ1AsT0FBTyxJQUFJLENBQUMsQ0FBQyxDQUFDO0lBQ2xCLENBQUM7SUFFTSxTQUFTO1FBQ1osT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDO0lBQ3RDLENBQUM7Q0FFSjtBQS9JRCx5QkErSUMiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpe2Z1bmN0aW9uIHIoZSxuLHQpe2Z1bmN0aW9uIG8oaSxmKXtpZighbltpXSl7aWYoIWVbaV0pe3ZhciBjPVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmU7aWYoIWYmJmMpcmV0dXJuIGMoaSwhMCk7aWYodSlyZXR1cm4gdShpLCEwKTt2YXIgYT1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK2krXCInXCIpO3Rocm93IGEuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixhfXZhciBwPW5baV09e2V4cG9ydHM6e319O2VbaV1bMF0uY2FsbChwLmV4cG9ydHMsZnVuY3Rpb24ocil7dmFyIG49ZVtpXVsxXVtyXTtyZXR1cm4gbyhufHxyKX0scCxwLmV4cG9ydHMscixlLG4sdCl9cmV0dXJuIG5baV0uZXhwb3J0c31mb3IodmFyIHU9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZSxpPTA7aTx0Lmxlbmd0aDtpKyspbyh0W2ldKTtyZXR1cm4gb31yZXR1cm4gcn0pKCkiLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBUZXN0Q291bnRlciB7XHJcbiAgICBwcml2YXRlIG46IG51bWJlcjtcclxuICAgIHB1YmxpYyBjb25zdHJ1Y3RvcigpIHtcclxuICAgICAgICB0aGlzLm4gPSAwO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBnZXROdW1iZXIoKTogbnVtYmVyIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5uO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzZXROdW1iZXIobjogbnVtYmVyKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5uID0gbjtcclxuICAgIH1cclxufSIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIElucHV0IHtcclxuXHJcbiAgICBwdWJsaWMgdXBLZXlEb3duOiBib29sZWFuO1xyXG4gICAgcHVibGljIGxlZnRLZXlEb3duOiBib29sZWFuO1xyXG4gICAgcHVibGljIHJpZ2h0S2V5RG93bjogYm9vbGVhbjtcclxuXHJcbiAgICBwdWJsaWMgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgdGhpcy5pbml0aWFsaXplSW5wdXRzKCk7XHJcbiAgICAgICAgdGhpcy51cEtleURvd24gPSBmYWxzZTtcclxuICAgICAgICB0aGlzLmxlZnRLZXlEb3duID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5yaWdodEtleURvd24gPSBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGluaXRpYWxpemVJbnB1dHMoKTogdm9pZCB7XHJcbiAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIChldikgPT4ge1xyXG4gICAgICAgICAgICBpZiAoZXYua2V5Q29kZSA9PT0gMzcpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMubGVmdEtleURvd24gPSB0cnVlO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGV2LmtleUNvZGUgPT09IDM5KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJpZ2h0S2V5RG93biA9IHRydWU7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZXYua2V5Q29kZSA9PT0gMzgpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMudXBLZXlEb3duID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIGV2LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXl1cCcsIChldikgPT4ge1xyXG4gICAgICAgICAgICBpZiAoZXYua2V5Q29kZSA9PT0gMzcpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMubGVmdEtleURvd24gPSBmYWxzZTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChldi5rZXlDb2RlID09PSAzOCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy51cEtleURvd24gPSBmYWxzZTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChldi5rZXlDb2RlID09PSAzOSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yaWdodEtleURvd24gPSBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59IiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgTGV2ZWwge1xyXG5cclxuICAgIHB1YmxpYyBsZXZlbE51bWJlcjogbnVtYmVyO1xyXG4gICAgcHVibGljIHRpdGxlOiBzdHJpbmc7XHJcbiAgICBwdWJsaWMgc3RhdHVzOiBzdHJpbmc7XHJcbiAgICBwdWJsaWMgZGlyZWN0aW9uczogc3RyaW5nO1xyXG5cclxuICAgIC8vIEFjY2VzcyBieSBuIC0gMSBmb3IgYXJyYXkgaW5kZXggdXNlXHJcbiAgICBwdWJsaWMgbGVmdExldmVsTnVtYmVyOiBudW1iZXI7XHJcbiAgICBwdWJsaWMgcmlnaHRMZXZlbE51bWJlcjogbnVtYmVyO1xyXG5cclxuICAgIHB1YmxpYyBiYWNrZ3JvdW5kOiBIVE1MSW1hZ2VFbGVtZW50O1xyXG5cclxuICAgIHB1YmxpYyBjb25zdHJ1Y3RvcihsZXZlbF9udW1iZXI6IG51bWJlciwgaW1nZGlyOiBzdHJpbmcsIHRpdGxlOiBzdHJpbmcsIHN0YXR1czogc3RyaW5nLFxyXG4gICAgICAgIGRpcmVjdGlvbnM6IHN0cmluZywgbGVmdDogbnVtYmVyLCByaWdodDogbnVtYmVyLFxyXG4gICAgICAgIGNhbnZhczogSFRNTENhbnZhc0VsZW1lbnQpIHtcclxuICAgICAgICB0aGlzLmxldmVsTnVtYmVyID0gbGV2ZWxfbnVtYmVyO1xyXG4gICAgICAgIHRoaXMuYmFja2dyb3VuZCA9IG5ldyBJbWFnZShjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQpO1xyXG4gICAgICAgIHRoaXMuYmFja2dyb3VuZC5zcmMgPSBpbWdkaXI7XHJcbiAgICAgICAgdGhpcy50aXRsZSA9IHRpdGxlO1xyXG4gICAgICAgIHRoaXMuc3RhdHVzID0gc3RhdHVzO1xyXG4gICAgICAgIHRoaXMuZGlyZWN0aW9ucyA9IGRpcmVjdGlvbnM7XHJcblxyXG4gICAgICAgIHRoaXMubGVmdExldmVsTnVtYmVyID0gbGVmdDtcclxuICAgICAgICB0aGlzLnJpZ2h0TGV2ZWxOdW1iZXIgPSByaWdodDtcclxuICAgIH1cclxufSIsImltcG9ydCBUZXN0Q291bnRlciBmcm9tICcuL2FwcC9UZXN0Q291bnRlcic7XHJcbmltcG9ydCBJbnB1dCBmcm9tICcuL2lucHV0L0lucHV0JztcclxuaW1wb3J0IEVudGl0eSBmcm9tICcuL29iai9FbnRpdHknO1xyXG5pbXBvcnQgeyBjb2xsYXBzZVRleHRDaGFuZ2VSYW5nZXNBY3Jvc3NNdWx0aXBsZVZlcnNpb25zIH0gZnJvbSAndHlwZXNjcmlwdCc7XHJcbmltcG9ydCBMZXZlbCBmcm9tICcuL2xldmVsL0xldmVsJztcclxuXHJcbmNvbnN0IFJFTkRFUl9DQU5WQVNfSUQ6IHN0cmluZyA9ICdyZW5kZXJDYW52YXMnO1xyXG5cclxuY29uc3QgVElUTEVfSUQ6IHN0cmluZyA9ICd0aXRsZSc7XHJcbmNvbnN0IFNUQVRVU19JRDogc3RyaW5nID0gJ3N0YXR1cyc7XHJcbmNvbnN0IERJUkVDVElPTlNfSUQ6IHN0cmluZyA9ICdkaXJlY3Rpb25zJztcclxuXHJcbmxldCB4OiBUZXN0Q291bnRlciA9IG5ldyBUZXN0Q291bnRlcigpO1xyXG5cclxubGV0IGNhbnZhczogSFRNTENhbnZhc0VsZW1lbnQgPSA8SFRNTENhbnZhc0VsZW1lbnQ+ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoUkVOREVSX0NBTlZBU19JRCk7XHJcbmxldCB0aXRsZUVsZW1lbnQ6IEhUTUxIZWFkaW5nRWxlbWVudCA9IDxIVE1MSGVhZGluZ0VsZW1lbnQ+ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoVElUTEVfSUQpO1xyXG5sZXQgc3RhdHVzRWxlbWVudDogSFRNTEhlYWRpbmdFbGVtZW50ID0gPEhUTUxIZWFkaW5nRWxlbWVudD5kb2N1bWVudC5nZXRFbGVtZW50QnlJZChTVEFUVVNfSUQpO1xyXG5sZXQgZGlyZWN0aW9uc0VsZW1lbnQ6IEhUTUxQYXJhZ3JhcGhFbGVtZW50ID0gPEhUTUxQYXJhZ3JhcGhFbGVtZW50PmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKERJUkVDVElPTlNfSUQpO1xyXG5sZXQgcjogQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEID0gPENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRD5jYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcclxubGV0IGNvdW50ZXI6IG51bWJlciA9IDA7XHJcblxyXG5sZXQga2V5Ym9hcmQ6IElucHV0O1xyXG5sZXQgY2hhcmFjdGVyOiBFbnRpdHk7XHJcbmxldCBiYWNrZ3JvdW5kOiBIVE1MSW1hZ2VFbGVtZW50O1xyXG5cclxubGV0IHRpdGxlOiBzdHJpbmc7XHJcbmxldCBzdGF0dXM6IHN0cmluZztcclxubGV0IGRpcmVjdGlvbjogc3RyaW5nO1xyXG5cclxubGV0IGN1cnJlbnRMZXZlbDogTGV2ZWw7XHJcbmxldCBsZXZlbHM6IEFycmF5PExldmVsPiA9IG5ldyBBcnJheTxMZXZlbD4oKTtcclxubGV2ZWxzLnB1c2gobmV3IExldmVsKDEsICdyZXMvYmcvMS5wbmcnLCAnWW91XFwncmUgYXQgQmxvY2tidXN0ZXInLCAnQWxpdmUnLCAnR28gbGVmdCBmb3IgeC4gR28gcmlnaHQgZm9yIHkuJywgMCwgMiwgY2FudmFzKSk7XHJcbmxldmVscy5wdXNoKG5ldyBMZXZlbCgwLCAncmVzL2JnLzAtdGVzdC5wbmcnLCAnWW91XFwncmUgb3V0c2lkZSBCbG9ja2J1c3RlcicsICdBbGl2ZScsICdHbyBsZWZ0IGZvciB4LiBHbyByaWdodCBmb3IgeS4nLCAxMSwgMiwgY2FudmFzKSk7XHJcblxyXG5mdW5jdGlvbiBmaW5kTGV2ZWwobGV2ZWxOdW1iZXI6IG51bWJlcik6IExldmVsIHtcclxuICAgIGZvciAobGV0IGk6IG51bWJlciA9IDA7IGkgPCBsZXZlbHMubGVuZ3RoOyArK2kpIHtcclxuICAgICAgICBpZiAobGV2ZWxzW2ldLmxldmVsTnVtYmVyID09PSBsZXZlbE51bWJlcikge1xyXG4gICAgICAgICAgICByZXR1cm4gbGV2ZWxzW2ldO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBsZXZlbHNbMF07XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGxvYWRMZXZlbChsZXZlbDogTGV2ZWwpOiB2b2lkIHtcclxuICAgIGNoYXJhY3Rlci5zZXRYKGNhbnZhcy53aWR0aCAvIDIgLSBjaGFyYWN0ZXIuZ2V0V2lkdGgoKSAvIDIpO1xyXG4gICAgY3VycmVudExldmVsID0gbGV2ZWw7XHJcbiAgICBiYWNrZ3JvdW5kID0gY3VycmVudExldmVsLmJhY2tncm91bmQ7XHJcbiAgICB0aXRsZUVsZW1lbnQudGV4dENvbnRlbnQgPSBjdXJyZW50TGV2ZWwudGl0bGU7XHJcbiAgICBzdGF0dXNFbGVtZW50LnRleHRDb250ZW50ID0gY3VycmVudExldmVsLnN0YXR1cztcclxuICAgIGRpcmVjdGlvbnNFbGVtZW50LnRleHRDb250ZW50ID0gY3VycmVudExldmVsLmRpcmVjdGlvbnM7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGluaXQoKTogdm9pZCB7XHJcbiAgICBjYW52YXMud2lkdGggPSA4MDA7XHJcbiAgICBjYW52YXMuaGVpZ2h0ID0gNDAwO1xyXG4gICAga2V5Ym9hcmQgPSBuZXcgSW5wdXQoKTtcclxuICAgIGNoYXJhY3RlciA9IG5ldyBFbnRpdHkoJ3Jlcy9zcHJpdGUvd2Fsay1sZWZ0LnBuZycsICdyZXMvc3ByaXRlL3dhbGstcmlnaHQucG5nJywgMjAwLCAyNzUpO1xyXG4gICAgci5mb250ID0gJzEycHggQXJpYWwgYmxhY2snO1xyXG4gICAgbG9hZExldmVsKGZpbmRMZXZlbCgxKSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGxvb3AoKTogdm9pZCB7XHJcbiAgICArK2NvdW50ZXI7XHJcbiAgICByLmNsZWFyUmVjdCgwLCAwLCBjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQpO1xyXG4gICAgci5maWxsVGV4dChjb3VudGVyLnRvU3RyaW5nKCksIDEwLCAxMCk7XHJcbiAgICBjaGFyYWN0ZXIudGljayhjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQpO1xyXG4gICAgaWYgKGtleWJvYXJkLmxlZnRLZXlEb3duKSB7XHJcbiAgICAgICAgY2hhcmFjdGVyLmFjY2VsZXJhdGVMZWZ0KDMpO1xyXG4gICAgfSBlbHNlIGlmIChrZXlib2FyZC5yaWdodEtleURvd24pIHtcclxuICAgICAgICBjaGFyYWN0ZXIuYWNjZWxlcmF0ZVJpZ2h0KDMpO1xyXG4gICAgfVxyXG4gICAgaWYgKGtleWJvYXJkLnVwS2V5RG93bikge1xyXG4gICAgICAgIGNoYXJhY3Rlci5hY2NlbGVyYXRlVXAoMjApO1xyXG4gICAgfVxyXG4gICAgci5kcmF3SW1hZ2UoYmFja2dyb3VuZCwgMCwgMCk7XHJcbiAgICByLmRyYXdJbWFnZShjaGFyYWN0ZXIuZ2V0SW1hZ2VTb3VyY2UoKSwgY2hhcmFjdGVyLmdldFgoKSwgY2hhcmFjdGVyLmdldFkoKSwgY2hhcmFjdGVyLmdldFdpZHRoKCksIGNoYXJhY3Rlci5nZXRIZWlnaHQoKSk7XHJcblxyXG4gICAgLy8gRGV0ZWN0IHRvIHN3aXRjaCBsZXZlbFxyXG4gICAgaWYgKGNoYXJhY3Rlci5sZWZ0V2FsbFRvdWNoZWQoKSkge1xyXG4gICAgICAgIGxvYWRMZXZlbChmaW5kTGV2ZWwoY3VycmVudExldmVsLmxlZnRMZXZlbE51bWJlcikpO1xyXG4gICAgfSBlbHNlIGlmIChjaGFyYWN0ZXIucmlnaHRXYWxsVG91Y2hlZCgpKSB7XHJcbiAgICAgICAgbG9hZExldmVsKGZpbmRMZXZlbChjdXJyZW50TGV2ZWwucmlnaHRMZXZlbE51bWJlcikpO1xyXG4gICAgfVxyXG5cclxuICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShsb29wKTtcclxufVxyXG5cclxuaW5pdCgpO1xyXG5sb29wKCk7IiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgRW50aXR5IHtcclxuXHJcbiAgICBwcml2YXRlIHJlYWRvbmx5IEdSQVZJVFk6IG51bWJlciA9IDkuODEgLyA0O1xyXG4gICAgcHJpdmF0ZSByZWFkb25seSBNQVhfVkVMT0NJVFk6IG51bWJlciA9IDc7XHJcblxyXG4gICAgcHJpdmF0ZSB4OiBudW1iZXI7XHJcbiAgICBwcml2YXRlIHk6IG51bWJlcjtcclxuXHJcbiAgICBwcml2YXRlIGR4OiBudW1iZXI7XHJcbiAgICBwcml2YXRlIGR5OiBudW1iZXI7XHJcblxyXG4gICAgcHJpdmF0ZSB4X3NpemU6IG51bWJlcjtcclxuICAgIHByaXZhdGUgeV9zaXplOiBudW1iZXI7XHJcblxyXG4gICAgcHJpdmF0ZSBoYXNKdW1wZWQ6IGJvb2xlYW47XHJcbiAgICBwcml2YXRlIGlzTGVmdFdhbGxUb3VjaGVkOiBib29sZWFuO1xyXG4gICAgcHJpdmF0ZSBpc1JpZ2h0V2FsbFRvdWNoZWQ6IGJvb2xlYW47XHJcbiAgICBwcml2YXRlIGxlZnRXYWxraW5nX3NyYzogc3RyaW5nO1xyXG4gICAgcHJpdmF0ZSByaWdodFdhbGtpbmdfc3JjOiBzdHJpbmc7XHJcblxyXG4gICAgcHJpdmF0ZSBpbWFnZTogSFRNTEltYWdlRWxlbWVudDtcclxuXHJcbiAgICBwdWJsaWMgY29uc3RydWN0b3Ioc3JjX2xlZnQ6IHN0cmluZywgc3JjX3JpZ2h0OiBzdHJpbmcsIHhfc2l6ZTogbnVtYmVyLCB5X3NpemU6IG51bWJlcikge1xyXG4gICAgICAgIHRoaXMueCA9IDA7XHJcbiAgICAgICAgdGhpcy55ID0gMDtcclxuICAgICAgICB0aGlzLmR4ID0gMDtcclxuICAgICAgICB0aGlzLmR5ID0gMDtcclxuXHJcbiAgICAgICAgdGhpcy5pbWFnZSA9IG5ldyBJbWFnZSh4X3NpemUsIHlfc2l6ZSk7XHJcbiAgICAgICAgdGhpcy5pbWFnZS5zcmMgPSBzcmNfbGVmdDtcclxuICAgICAgICB0aGlzLnhfc2l6ZSA9IHhfc2l6ZTtcclxuICAgICAgICB0aGlzLnlfc2l6ZSA9IHlfc2l6ZTtcclxuICAgICAgICB0aGlzLmhhc0p1bXBlZCA9IHRydWU7XHJcbiAgICAgICAgdGhpcy5pc0xlZnRXYWxsVG91Y2hlZCA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMuaXNSaWdodFdhbGxUb3VjaGVkID0gZmFsc2U7XHJcblxyXG4gICAgICAgIHRoaXMubGVmdFdhbGtpbmdfc3JjID0gc3JjX2xlZnQ7XHJcbiAgICAgICAgdGhpcy5yaWdodFdhbGtpbmdfc3JjID0gc3JjX3JpZ2h0O1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBsZWZ0V2FsbFRvdWNoZWQoKTogYm9vbGVhbiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaXNMZWZ0V2FsbFRvdWNoZWQ7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHJpZ2h0V2FsbFRvdWNoZWQoKTogYm9vbGVhbiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaXNSaWdodFdhbGxUb3VjaGVkO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyB0aWNrKHhfbWF4OiBudW1iZXIsIHlfbWF4OiBudW1iZXIpOiB2b2lkIHtcclxuXHJcbiAgICAgICAgdGhpcy54ICs9IHRoaXMuZHg7XHJcbiAgICAgICAgdGhpcy5keSArPSB0aGlzLkdSQVZJVFk7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLnggKyB0aGlzLmltYWdlLndpZHRoID4geF9tYXgpIHtcclxuICAgICAgICAgICAgLy8gUmlnaHQgd2FsbFxyXG4gICAgICAgICAgICB0aGlzLmlzUmlnaHRXYWxsVG91Y2hlZCA9IHRydWU7XHJcbiAgICAgICAgICAgIHRoaXMueCA9IHhfbWF4IC0gdGhpcy5pbWFnZS53aWR0aDtcclxuICAgICAgICB9IGVsc2UgaWYgKHRoaXMueCA8IDApIHtcclxuICAgICAgICAgICAgdGhpcy5pc0xlZnRXYWxsVG91Y2hlZCA9IHRydWU7XHJcbiAgICAgICAgICAgIHRoaXMueCA9IDA7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5pc1JpZ2h0V2FsbFRvdWNoZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgdGhpcy5pc0xlZnRXYWxsVG91Y2hlZCA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy55ICs9IHRoaXMuZHk7XHJcblxyXG4gICAgICAgIC8vIEhpdCB0aGUgZ3JvdW5kXHJcbiAgICAgICAgaWYgKHRoaXMueSArIHRoaXMueV9zaXplID49IHlfbWF4KSB7XHJcbiAgICAgICAgICAgIHRoaXMueSA9IHlfbWF4IC0gdGhpcy55X3NpemU7XHJcbiAgICAgICAgICAgIHRoaXMuZHkgPSAwO1xyXG4gICAgICAgICAgICB0aGlzLmhhc0p1bXBlZCA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gRnJpY3Rpb25cclxuICAgICAgICBpZiAodGhpcy5keCA+IDApIHtcclxuICAgICAgICAgICAgLy8gR29pbmcgcmlnaHRcclxuICAgICAgICAgICAgdGhpcy5pbWFnZS5zcmMgPSB0aGlzLnJpZ2h0V2Fsa2luZ19zcmM7XHJcbiAgICAgICAgICAgIC0tdGhpcy5keDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMuZHggPCAwKSB7XHJcbiAgICAgICAgICAgIC8vIEdvaW5nIGxlZnRcclxuICAgICAgICAgICAgdGhpcy5pbWFnZS5zcmMgPSB0aGlzLmxlZnRXYWxraW5nX3NyYztcclxuICAgICAgICAgICAgKyt0aGlzLmR4O1xyXG4gICAgICAgIH0gZWxzZSB7XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGdldFdpZHRoKCk6IG51bWJlciB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMueF9zaXplO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBnZXRIZWlnaHQoKTogbnVtYmVyIHtcclxuICAgICAgICByZXR1cm4gdGhpcy55X3NpemU7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGdldEltYWdlU291cmNlKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmltYWdlO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBhY2NlbGVyYXRlTGVmdChzcGVlZDogbnVtYmVyKSB7XHJcbiAgICAgICAgdGhpcy5keCAtPSBzcGVlZDtcclxuICAgICAgICBpZiAodGhpcy5keCA8IC10aGlzLk1BWF9WRUxPQ0lUWSkge1xyXG4gICAgICAgICAgICB0aGlzLmR4ID0gLXRoaXMuTUFYX1ZFTE9DSVRZO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgYWNjZWxlcmF0ZVJpZ2h0KHNwZWVkOiBudW1iZXIpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLmR4ICs9IHNwZWVkO1xyXG4gICAgICAgIGlmICh0aGlzLmR4ID4gdGhpcy5NQVhfVkVMT0NJVFkpIHtcclxuICAgICAgICAgICAgdGhpcy5keCA9IHRoaXMuTUFYX1ZFTE9DSVRZO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgYWNjZWxlcmF0ZVVwKHNwZWVkOiBudW1iZXIpOiB2b2lkIHtcclxuICAgICAgICBpZiAoIXRoaXMuaGFzSnVtcGVkKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaGFzSnVtcGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgdGhpcy5keSAtPSBzcGVlZDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHNldFgoeDogbnVtYmVyKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy54ID0geDtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgc2V0WSh5OiBudW1iZXIpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLnkgPSB5O1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBnZXRYKCk6IG51bWJlciB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMueDtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZ2V0WSgpOiBudW1iZXIge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGdldFlMb3dlcigpOiBudW1iZXIge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmltYWdlLmhlaWdodCArIHRoaXMueTtcclxuICAgIH1cclxuXHJcbn0iXX0=
